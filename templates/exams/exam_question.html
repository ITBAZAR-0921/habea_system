{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div class="fw-bold">Асуулт {{ current_number }} / {{ total_questions }}</div>
    <div class="badge text-bg-danger fs-6" id="timer">--:--</div>
</div>

<div class="card mb-3">
    <div class="card-body">
        <h5 class="card-title mb-3">{{ question.text }}</h5>
        {% if question.image %}
        <img src="{{ question.image.url }}" alt="Question image" class="img-fluid rounded border mb-3" />
        {% endif %}

        <form method="post" class="mt-3">
            {% csrf_token %}
            <div class="d-grid gap-2">
                {% for radio in form.choice %}
                <label class="border rounded p-3" style="cursor:pointer;">
                    {{ radio.tag }}
                    <span class="ms-2">{{ radio.choice_label }}</span>
                </label>
                {% endfor %}
            </div>
            {% if form.choice.errors %}
            <div class="text-danger mt-2">{{ form.choice.errors }}</div>
            {% endif %}
            <div class="d-flex gap-2 mt-4">
                {% if prev_number %}
                <a href="{% url 'attempt_question' attempt_id prev_number %}" class="btn btn-outline-secondary btn-lg">Өмнөх</a>
                {% endif %}
                <button type="submit" class="btn btn-primary btn-lg">Дараах</button>
            </div>
        </form>
    </div>
</div>

<script>
(function(){
    var seconds = {{ remaining_seconds }};
    var timerEl = document.getElementById('timer');
    var finishUrl = "{% url 'attempt_finish' attempt_id %}";

    function render() {
        var m = Math.floor(seconds / 60);
        var s = seconds % 60;
        timerEl.textContent = String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
    }

    render();
    var interval = setInterval(function() {
        seconds -= 1;
        if (seconds <= 0) {
            clearInterval(interval);
            window.location.href = finishUrl;
            return;
        }
        render();
    }, 1000);
})();
</script>
{% endblock %}
